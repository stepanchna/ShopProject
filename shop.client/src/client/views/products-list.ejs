<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список товаров</title>
</head>

<body>
    <h1>Список товаров (<span id="product-count">0</span>)</h1>

    <label for="search">Поиск по названию:</label>
    <input type="text" id="search" placeholder="Поиск по названию" oninput="filterProducts()">

    <label for="min-price">Цена от:</label>
    <input type="number" id="min-price" placeholder="Минимальная цена" oninput="filterProducts()">

    <label for="max-price">Цена до:</label>
    <input type="number" id="max-price" placeholder="Максимальная цена" oninput="filterProducts()">

    <ul id="product-list"></ul>

    <script>
        let products = [];
        // Загружаем список товаров
        fetch('/api/products')
            .then(response => response.json())
            .then(data => {
                products = data;
                renderProducts(products);
                document.getElementById('product-count').textContent = products.length;
            });

        function renderProducts(productsToRender) {
            const list = document.getElementById('product-list');
            list.innerHTML = ''; // Очищаем список перед рендером
            productsToRender.forEach(product => {
                const item = document.createElement('li');
                item.innerHTML = `
          <a href="/${product.id}">${product.title}</a> — ${product.price}₽
        `;
                list.appendChild(item);
            });
        }

        function filterProducts() {
            const search = document.getElementById('search').value.toLowerCase();
            const minPrice = parseFloat(document.getElementById('min-price').value) || 0;
            const maxPrice = parseFloat(document.getElementById('max-price').value) || Infinity;

            const filteredProducts = products.filter(product =>
                product.title.toLowerCase().includes(search) &&
                product.price >= minPrice && product.price <= maxPrice
            );

            renderProducts(filteredProducts);
        }
    </script>
</body>

</html>